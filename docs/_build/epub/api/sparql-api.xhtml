<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SPARQL API Guide</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../_static/epub.css?v=1d6d279e" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3afbad45" />
    <link rel="stylesheet" type="text/css" href="../_static/interactive.css?v=267755d7" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="sparql-api-guide">
<h1>SPARQL API Guide</h1>
<p>The ProvChainOrg SPARQL API provides a W3C-compliant interface for querying semantic blockchain data. This guide covers all aspects of using SPARQL with ProvChainOrg, from basic queries to advanced optimization techniques.</p>
<section id="overview">
<h2>Overview</h2>
<p>ProvChainOrg exposes a full SPARQL 1.1 endpoint that allows you to query across all blockchain data stored as RDF graphs. The SPARQL endpoint supports:</p>
<ul class="simple">
<li><p><strong>SPARQL 1.1 Query</strong> - Data retrieval with complex patterns</p></li>
<li><p><strong>SPARQL 1.1 Update</strong> - Data modification (when authorized)</p></li>
<li><p><strong>SPARQL Federated Queries</strong> - Querying external RDF datasets</p></li>
<li><p><strong>SPARQL Algebra</strong> - Advanced query optimization</p></li>
<li><p><strong>SPARQL Results</strong> - Multiple serialization formats</p></li>
</ul>
</section>
<section id="endpoint">
<h2>Endpoint</h2>
<p><strong>SPARQL Endpoint:</strong> <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/sparql</span></code></p>
<p><strong>Content-Type Headers:</strong>
- <code class="docutils literal notranslate"><span class="pre">application/sparql-query</span></code> - For SELECT, ASK, and DESCRIBE queries
- <code class="docutils literal notranslate"><span class="pre">application/sparql-update</span></code> - For INSERT, DELETE, and MODIFY operations</p>
<p><strong>Authentication:</strong>
Include API key in headers:
<code class="docutils literal notranslate"><span class="pre">`http</span>
<span class="pre">Authorization:</span> <span class="pre">Bearer</span> <span class="pre">YOUR_API_KEY</span>
<span class="pre">`</span></code></p>
</section>
<section id="named-graphs">
<h2>Named Graphs</h2>
<p>ProvChainOrg organizes blockchain data in named graphs:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">http://provchain.org/block/{index}</span>&#160;&#160;&#160; <span class="pre">-</span> <span class="pre">Data</span> <span class="pre">for</span> <span class="pre">block</span> <span class="pre">{index}</span>
<span class="pre">http://provchain.org/ontology</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">-</span> <span class="pre">Traceability</span> <span class="pre">ontology</span>
<span class="pre">http://provchain.org/metadata</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">-</span> <span class="pre">Blockchain</span> <span class="pre">metadata</span>
<span class="pre">`</span></code></p>
</section>
<section id="basic-queries">
<h2>Basic Queries</h2>
<section id="select-queries">
<h3>SELECT Queries</h3>
<p>Retrieve specific data with variable bindings.</p>
<p><strong>Example: Find all product batches</strong>
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
SELECT ?batch ?product ?farm WHERE {</p>
<blockquote>
<div><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product ;
:originFarm ?farm .</p>
</dd>
</dl>
</div></blockquote>
<section id="id5">
<h4>}</h4>
<p><strong>Example: Get batch details with filtering</strong>
<a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
PREFIX xsd: &lt;<a class="reference external" href="http://www.w3.org/2001">http://www.w3.org/2001</a>/XMLSchema#&gt;</p>
<dl>
<dt>SELECT ?batch ?product ?harvestDate WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product ;
:harvestDate ?harvestDate .</p>
</dd>
</dl>
<p>FILTER(?harvestDate &gt;= “2025-01-01”^^xsd:date)</p>
</dd>
</dl>
<p>}
ORDER BY DESC(?harvestDate)
LIMIT 10
<a href="#id10"><span class="problematic" id="id11">``</span></a><a href="#id12"><span class="problematic" id="id13">`</span></a></p>
</section>
</section>
<section id="ask-queries">
<h3>ASK Queries</h3>
<p>Check if data exists without retrieving results.</p>
<p><strong>Example: Check for specific batch</strong>
<a href="#id14"><span class="problematic" id="id15">``</span></a><a href="#id16"><span class="problematic" id="id17">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl class="simple">
<dt>ASK WHERE {</dt><dd><p>:Batch001 a :ProductBatch .</p>
</dd>
</dl>
<section id="id18">
<h4>}</h4>
</section>
</section>
<section id="describe-queries">
<h3>DESCRIBE Queries</h3>
<p>Retrieve RDF data describing resources.</p>
<p><strong>Example: Get complete batch information</strong>
<a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<p>DESCRIBE :Batch001
<a href="#id23"><span class="problematic" id="id24">``</span></a><a href="#id25"><span class="problematic" id="id26">`</span></a></p>
</section>
<section id="construct-queries">
<h3>CONSTRUCT Queries</h3>
<p>Generate new RDF data from query results.</p>
<p><strong>Example: Create batch summary</strong>
<a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
PREFIX prov: &lt;<a class="reference external" href="http://www.w3.org/ns">http://www.w3.org/ns</a>/prov#&gt;
PREFIX rdfs: &lt;<a class="reference external" href="http://www.w3.org/2000/01/rdf">http://www.w3.org/2000/01/rdf</a>-schema#&gt;</p>
<dl class="simple">
<dt>CONSTRUCT {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatchSummary ;</dt><dd><p>:hasProduct ?product ;
:hasOriginFarm ?farm ;
:hasHarvestDate ?date .</p>
</dd>
</dl>
</dd>
<dt>} WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product ;
:originFarm ?farm ;
:harvestDate ?date .</p>
</dd>
</dl>
</dd>
</dl>
<section id="id31">
<h4>}</h4>
</section>
</section>
</section>
<section id="advanced-queries">
<h2>Advanced Queries</h2>
<section id="graph-patterns">
<h3>Graph Patterns</h3>
<p>Query across multiple named graphs.</p>
<p><strong>Example: Query all blockchain data</strong>
<a href="#id32"><span class="problematic" id="id33">``</span></a><a href="#id34"><span class="problematic" id="id35">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?product ?timestamp WHERE {</dt><dd><dl class="simple">
<dt>GRAPH ?blockGraph {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
</dl>
</dd>
</dl>
<p>}
?blockGraph :blockIndex ?index ;</p>
<blockquote>
<div><p>:timestamp ?timestamp .</p>
</div></blockquote>
</dd>
</dl>
<p>}
ORDER BY ?timestamp
<a href="#id36"><span class="problematic" id="id37">``</span></a><a href="#id38"><span class="problematic" id="id39">`</span></a></p>
</section>
<section id="optional-patterns">
<h3>Optional Patterns</h3>
<p>Include optional data that may not exist.</p>
<p><strong>Example: Get batches with optional environmental data</strong>
<a href="#id40"><span class="problematic" id="id41">``</span></a><a href="#id42"><span class="problematic" id="id43">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?product ?temperature ?humidity WHERE {</dt><dd><dl>
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
<dt>OPTIONAL {</dt><dd><p>?batch :transportedThrough ?transport .
?transport :environmentalCondition ?condition .
?condition :temperature ?temperature ;</p>
<blockquote>
<div><p>:humidity ?humidity .</p>
</div></blockquote>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<section id="id44">
<h4>}</h4>
</section>
</section>
<section id="union-queries">
<h3>Union Queries</h3>
<p>Combine results from multiple patterns.</p>
<p><strong>Example: Find products from farms or processing plants</strong>
<a href="#id45"><span class="problematic" id="id46">``</span></a><a href="#id47"><span class="problematic" id="id48">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?location ?type WHERE {</dt><dd><dl>
<dt>{</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:originFarm ?farm .</p>
</dd>
</dl>
<p>?farm :location ?location .
BIND(“Farm” AS ?type)</p>
</dd>
</dl>
<p>}
UNION
{</p>
<blockquote>
<div><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:processedAt ?plant .</p>
</dd>
</dl>
<p>?plant :location ?location .
BIND(“Processing Plant” AS ?type)</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<section id="id49">
<h4>}</h4>
</section>
</section>
<section id="subqueries">
<h3>Subqueries</h3>
<p>Use nested queries for complex filtering.</p>
<p><strong>Example: Find batches with recent environmental monitoring</strong>
<a href="#id50"><span class="problematic" id="id51">``</span></a><a href="#id52"><span class="problematic" id="id53">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
PREFIX xsd: &lt;<a class="reference external" href="http://www.w3.org/2001">http://www.w3.org/2001</a>/XMLSchema#&gt;</p>
<dl>
<dt>SELECT ?batch ?product WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
</dl>
<p>?batch :transportedThrough ?transport .
?transport :environmentalCondition ?condition .
?condition :recordedAt ?timestamp .
FILTER(?timestamp &gt;= NOW() - “PT24H”^^xsd:duration)</p>
</dd>
</dl>
<section id="id54">
<h4>}</h4>
</section>
</section>
<section id="aggregate-functions">
<h3>Aggregate Functions</h3>
<p>Perform calculations on query results.</p>
<p><strong>Example: Count batches by product type</strong>
<a href="#id55"><span class="problematic" id="id56">``</span></a><a href="#id57"><span class="problematic" id="id58">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl class="simple">
<dt>SELECT ?product (COUNT(?batch) AS ?batchCount) WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
</dl>
</dd>
</dl>
<p>}
GROUP BY ?product
ORDER BY DESC(?batchCount)
<a href="#id59"><span class="problematic" id="id60">``</span></a><a href="#id61"><span class="problematic" id="id62">`</span></a></p>
<p><strong>Example: Calculate average temperature</strong>
<a href="#id63"><span class="problematic" id="id64">``</span></a><a href="#id65"><span class="problematic" id="id66">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl class="simple">
<dt>SELECT (AVG(?temperature) AS ?avgTemp) (MAX(?temperature) AS ?maxTemp) WHERE {</dt><dd><p>?condition :temperature ?temperature .</p>
</dd>
</dl>
<section id="id67">
<h4>}</h4>
</section>
</section>
<section id="window-functions">
<h3>Window Functions</h3>
<p>Perform calculations over result sets.</p>
<p><strong>Example: Rank batches by harvest date</strong>
<a href="#id68"><span class="problematic" id="id69">``</span></a><a href="#id70"><span class="problematic" id="id71">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
PREFIX xsd: &lt;<a class="reference external" href="http://www.w3.org/2001">http://www.w3.org/2001</a>/XMLSchema#&gt;</p>
<dl class="simple">
<dt>SELECT ?batch ?harvestDate (RANK() OVER (ORDER BY ?harvestDate DESC) AS ?rank) WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:harvestDate ?harvestDate .</p>
</dd>
</dl>
</dd>
</dl>
<section id="id72">
<h4>}</h4>
</section>
</section>
</section>
<section id="federated-queries">
<h2>Federated Queries</h2>
<p>Query external RDF datasets alongside blockchain data.</p>
<p><strong>Example: Query external product catalog</strong>
<a href="#id73"><span class="problematic" id="id74">``</span></a><a href="#id75"><span class="problematic" id="id76">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
PREFIX skos: &lt;<a class="reference external" href="http://www.w3.org/2004/02/skos">http://www.w3.org/2004/02/skos</a>/core#&gt;</p>
<dl>
<dt>SELECT ?batch ?product ?externalDescription WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
<dt>SERVICE &lt;<a class="reference external" href="http://external-catalog.org/sparql">http://external-catalog.org/sparql</a>&gt; {</dt><dd><p>?product skos:prefLabel ?externalDescription .</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
</section>
<section id="ontology-aware-queries">
<h2>Ontology-Aware Queries</h2>
<p>Leverage the traceability ontology for semantic queries.</p>
<p><strong>Example: Find all organic products</strong>
<a href="#id77"><span class="problematic" id="id78">``</span></a><a href="#id79"><span class="problematic" id="id80">`</span></a>sparql
PREFIX trace: &lt;<a class="reference external" href="http://provchain.org">http://provchain.org</a>/trace#&gt;
PREFIX owl: &lt;<a class="reference external" href="http://www.w3.org/2002/07">http://www.w3.org/2002/07</a>/owl#&gt;</p>
<dl>
<dt>SELECT ?batch ?product WHERE {</dt><dd><dl class="simple">
<dt>?batch a trace:ProductBatch ;</dt><dd><p>trace:product ?product .</p>
</dd>
</dl>
<p>?product trace:isOrganic true .</p>
</dd>
</dl>
<p><strong>Example: Trace complete supply chain</strong>
<a href="#id81"><span class="problematic" id="id82">``</span></a><a href="#id83"><span class="problematic" id="id84">`</span></a>sparql
PREFIX trace: &lt;<a class="reference external" href="http://provchain.org">http://provchain.org</a>/trace#&gt;
PREFIX prov: &lt;<a class="reference external" href="http://www.w3.org/ns">http://www.w3.org/ns</a>/prov#&gt;</p>
<dl class="simple">
<dt>SELECT ?batch ?activity ?agent ?timestamp WHERE {</dt><dd><dl class="simple">
<dt>?batch a trace:ProductBatch ;</dt><dd><p>trace:hasBatchID “MB001” .</p>
</dd>
<dt>?activity prov:used ?batch ;</dt><dd><p>prov:wasAssociatedWith ?agent ;
trace:recordedAt ?timestamp .</p>
</dd>
</dl>
</dd>
</dl>
<p>}
ORDER BY ?timestamp
<a href="#id85"><span class="problematic" id="id86">``</span></a><a href="#id87"><span class="problematic" id="id88">`</span></a></p>
</section>
<section id="property-paths">
<h2>Property Paths</h2>
<p>Use property paths for complex graph traversals.</p>
<p><strong>Example: Find all products from a specific farm (direct or indirect)</strong>
<a href="#id89"><span class="problematic" id="id90">``</span></a><a href="#id91"><span class="problematic" id="id92">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl class="simple">
<dt>SELECT ?batch ?product WHERE {</dt><dd><p>:GreenValleyFarm :supplies*/:hasBatch ?batch .
?batch :product ?product .</p>
</dd>
</dl>
<p><strong>Example: Find environmental conditions along transport path</strong>
<a href="#id93"><span class="problematic" id="id94">``</span></a><a href="#id95"><span class="problematic" id="id96">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?temp ?humidity ?location WHERE {</dt><dd><p>?batch :transportedThrough*/:hasCondition ?condition .
?condition :temperature ?temp ;</p>
<blockquote>
<div><p>:humidity ?humidity ;
:location ?location .</p>
</div></blockquote>
</dd>
</dl>
</section>
<section id="query-optimization">
<h2>Query Optimization</h2>
<section id="indexing-strategies">
<h3>Indexing Strategies</h3>
<p>ProvChainOrg automatically indexes common query patterns:</p>
<ul class="simple">
<li><p><strong>Subject Index</strong>: Fast lookup by subject URI</p></li>
<li><p><strong>Predicate Index</strong>: Fast lookup by predicate URI</p></li>
<li><p><strong>Object Index</strong>: Fast lookup by literal values</p></li>
<li><p><strong>Triple Pattern Index</strong>: Optimized for triple pattern matching</p></li>
</ul>
<p><strong>Best Practices:</strong>
1. Use LIMIT clauses for large result sets
2. Filter early in the query
3. Use specific property paths instead of wildcards
4. Leverage named graph patterns when possible</p>
</section>
<section id="query-hints">
<h3>Query Hints</h3>
<p>Provide optimization hints to the query engine.</p>
<p><strong>Example: Use specific index hint</strong>
<a href="#id97"><span class="problematic" id="id98">``</span></a><a href="#id99"><span class="problematic" id="id100">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?product WHERE {</dt><dd><p>/<a href="#id101"><span class="problematic" id="id102">*</span></a>+ INDEX(subject) <a href="#id103"><span class="problematic" id="id104">*</span></a>/
?batch a :ProductBatch ;</p>
<blockquote>
<div><p>:product ?product .</p>
</div></blockquote>
</dd>
</dl>
<section id="id105">
<h4>}</h4>
</section>
</section>
<section id="performance-monitoring">
<h3>Performance Monitoring</h3>
<p>Monitor query performance with EXPLAIN.</p>
<p><strong>Example: Get query execution plan</strong>
<a href="#id106"><span class="problematic" id="id107">``</span></a><a href="#id108"><span class="problematic" id="id109">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<p>EXPLAIN
SELECT ?batch ?product WHERE {</p>
<blockquote>
<div><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
</dl>
</div></blockquote>
<section id="id110">
<h4>}</h4>
</section>
</section>
</section>
<section id="update-operations">
<h2>Update Operations</h2>
<section id="insert-data">
<h3>INSERT Data</h3>
<p>Add new RDF data to the blockchain.</p>
<p><strong>Example: Add new product batch</strong>
<a href="#id111"><span class="problematic" id="id112">``</span></a><a href="#id113"><span class="problematic" id="id114">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;
PREFIX xsd: &lt;<a class="reference external" href="http://www.w3.org/2001">http://www.w3.org/2001</a>/XMLSchema#&gt;</p>
<dl class="simple">
<dt>INSERT DATA {</dt><dd><dl class="simple">
<dt>:Batch003 a :ProductBatch ;</dt><dd><p>:hasBatchID “BATCH-003” ;
:product :OrganicApples ;
:harvestDate “2025-01-15”^^xsd:date ;
:originFarm :AppleOrchardFarm .</p>
</dd>
</dl>
</dd>
</dl>
<section id="id115">
<h4>}</h4>
</section>
</section>
<section id="delete-data">
<h3>DELETE Data</h3>
<p>Remove specific RDF triples.</p>
<p><strong>Example: Remove outdated environmental data</strong>
<a href="#id116"><span class="problematic" id="id117">``</span></a><a href="#id118"><span class="problematic" id="id119">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl class="simple">
<dt>DELETE {</dt><dd><p>:Batch001 :hasCondition ?oldCondition .</p>
</dd>
</dl>
<p>}
WHERE {</p>
<blockquote>
<div><p>:Batch001 :hasCondition ?oldCondition .
?oldCondition :recordedAt ?timestamp .
FILTER(?timestamp &lt; “2025-01-01”^^xsd:dateTime)</p>
</div></blockquote>
<section id="id120">
<h4>}</h4>
</section>
</section>
<section id="modify-operations">
<h3>MODIFY Operations</h3>
<p>Combine insert and delete operations.</p>
<p><strong>Example: Update batch status</strong>
<a href="#id121"><span class="problematic" id="id122">``</span></a><a href="#id123"><span class="problematic" id="id124">`</span></a>sparql
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>MODIFY {</dt><dd><dl class="simple">
<dt>DELETE {</dt><dd><p>:Batch001 :status ?oldStatus .</p>
</dd>
</dl>
<p>}
INSERT {</p>
<blockquote>
<div><p>:Batch001 :status :Shipped .</p>
</div></blockquote>
<p>}
WHERE {</p>
<blockquote>
<div><p>:Batch001 :status ?oldStatus .
FILTER(?oldStatus = :Processed)</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<section id="id125">
<h4>}</h4>
</section>
</section>
<section id="load-operations">
<h3>LOAD Operations</h3>
<p>Load external RDF data.</p>
<p><strong>Example: Load external ontology</strong>
<code class="docutils literal notranslate"><span class="pre">`sparql</span>
<span class="pre">LOAD</span> <span class="pre">&lt;http://example.org/external-ontology.ttl&gt;</span>
<span class="pre">INTO</span> <span class="pre">GRAPH</span> <span class="pre">&lt;http://provchain.org/external&gt;</span>
<span class="pre">`</span></code></p>
</section>
</section>
<section id="query-templates">
<h2>Query Templates</h2>
<p>Reusable query patterns for common operations.</p>
<section id="batch-tracking-template">
<h3>Batch Tracking Template</h3>
<p><a href="#id126"><span class="problematic" id="id127">``</span></a><a href="#id128"><span class="problematic" id="id129">`</span></a>sparql
# Template: Track batch through supply chain
PREFIX trace: &lt;<a class="reference external" href="http://provchain.org">http://provchain.org</a>/trace#&gt;
PREFIX prov: &lt;<a class="reference external" href="http://www.w3.org/ns">http://www.w3.org/ns</a>/prov#&gt;</p>
<dl>
<dt>SELECT ?batch ?activity ?agent ?timestamp ?location WHERE {</dt><dd><dl class="simple">
<dt>?batch a trace:ProductBatch ;</dt><dd><p>trace:hasBatchID “{{BATCH_ID}}” .</p>
</dd>
<dt>?activity prov:used ?batch ;</dt><dd><p>prov:wasAssociatedWith ?agent ;
trace:recordedAt ?timestamp .</p>
</dd>
<dt>OPTIONAL {</dt><dd><p>?activity :atLocation ?location .</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}
ORDER BY ?timestamp
<a href="#id130"><span class="problematic" id="id131">``</span></a><a href="#id132"><span class="problematic" id="id133">`</span></a></p>
</section>
<section id="environmental-monitoring-template">
<h3>Environmental Monitoring Template</h3>
<p><a href="#id134"><span class="problematic" id="id135">``</span></a><a href="#id136"><span class="problematic" id="id137">`</span></a>sparql
# Template: Monitor environmental conditions
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?temperature ?humidity ?location ?timestamp WHERE {</dt><dd><p>?batch :transportedThrough ?transport .
?transport :environmentalCondition ?condition .
?condition :temperature ?temperature ;</p>
<blockquote>
<div><p>:humidity ?humidity ;
:location ?location ;
:recordedAt ?timestamp .</p>
</div></blockquote>
<p>FILTER(?temperature &gt; {{TEMP_THRESHOLD}})</p>
</dd>
</dl>
<p>}
ORDER BY ?timestamp DESC
<a href="#id138"><span class="problematic" id="id139">``</span></a><a href="#id140"><span class="problematic" id="id141">`</span></a></p>
</section>
<section id="quality-assurance-template">
<h3>Quality Assurance Template</h3>
<p><a href="#id142"><span class="problematic" id="id143">``</span></a><a href="#id144"><span class="problematic" id="id145">`</span></a>sparql
# Template: Quality assurance checks
PREFIX trace: &lt;<a class="reference external" href="http://provchain.org">http://provchain.org</a>/trace#&gt;</p>
<dl>
<dt>SELECT ?batch ?issue ?severity WHERE {</dt><dd><dl class="simple">
<dt>?batch a trace:ProductBatch ;</dt><dd><p>trace:hasBatchID “{{BATCH_ID}}” .</p>
</dd>
</dl>
<p>?batch trace:qualityIssue ?issue .
?issue trace:hasSeverity ?severity .
FILTER(?severity IN {{SEVERITY_LEVELS}})</p>
</dd>
</dl>
<section id="id146">
<h4>}</h4>
</section>
</section>
</section>
<section id="error-handling">
<h2>Error Handling</h2>
<section id="common-query-errors">
<h3>Common Query Errors</h3>
<dl class="simple">
<dt><strong>Syntax Errors</strong></dt><dd><ul class="simple">
<li><p>Check SPARQL syntax carefully</p></li>
<li><p>Use proper prefixes and URIs</p></li>
<li><p>Ensure balanced parentheses and brackets</p></li>
</ul>
</dd>
<dt><strong>Timeout Errors</strong></dt><dd><ul class="simple">
<li><p>Add LIMIT clauses to large queries</p></li>
<li><p>Optimize FILTER conditions</p></li>
<li><p>Use more specific patterns</p></li>
</ul>
</dd>
<dt><strong>Memory Errors</strong></dt><dd><ul class="simple">
<li><p>Break complex queries into smaller parts</p></li>
<li><p>Use pagination with OFFSET/LIMIT</p></li>
<li><p>Consider using CONSTRUCT instead of SELECT for large results</p></li>
</ul>
</dd>
<dt><strong>Permission Errors</strong></dt><dd><ul class="simple">
<li><p>Verify API key is valid</p></li>
<li><p>Check user permissions for update operations</p></li>
<li><p>Ensure authentication headers are properly set</p></li>
</ul>
</dd>
</dl>
</section>
<section id="debugging-techniques">
<h3>Debugging Techniques</h3>
<p><strong>Step-by-step Query Building</strong>
1. Start with simple pattern matching
2. Add optional elements gradually
3. Include filters one at a time
4. Test with LIMIT clauses first</p>
<p><strong>Query Validation</strong>
<a href="#id147"><span class="problematic" id="id148">``</span></a><a href="#id149"><span class="problematic" id="id150">`</span></a>sparql
# Validate query structure
ASK WHERE {</p>
<blockquote>
<div><p># Test basic pattern matching first
?s ?p ?o .</p>
</div></blockquote>
<section id="id151">
<h4>}</h4>
<p><strong>Variable Binding Inspection</strong>
<a href="#id152"><span class="problematic" id="id153">``</span></a><a href="#id154"><span class="problematic" id="id155">`</span></a>sparql
# Check intermediate results
SELECT ?batch ?product WHERE {</p>
<blockquote>
<div><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:product ?product .</p>
</dd>
</dl>
</div></blockquote>
<p>}
LIMIT 5  # Test with small result set first
<a href="#id156"><span class="problematic" id="id157">``</span></a><a href="#id158"><span class="problematic" id="id159">`</span></a></p>
</section>
</section>
</section>
<section id="best-practices">
<h2>Best Practices</h2>
<ol class="arabic simple">
<li><p><strong>Use Meaningful Variable Names</strong>: Make queries more readable and maintainable.</p></li>
<li><p><strong>Leverage Named Graphs</strong>: Specify exact graphs when possible for better performance.</p></li>
<li><p><strong>Filter Early</strong>: Apply FILTER conditions as early as possible in the query.</p></li>
<li><p><strong>Use LIMIT Clauses</strong>: Always use LIMIT for exploratory queries to avoid large result sets.</p></li>
<li><p><strong>Optimize Property Paths</strong>: Use specific paths instead of wildcards when possible.</p></li>
<li><p><strong>Cache Results</strong>: Cache frequently executed queries for better performance.</p></li>
<li><p><strong>Use Templates</strong>: Create reusable query templates for common operations.</p></li>
<li><p><strong>Monitor Performance</strong>: Regularly review query performance and optimize as needed.</p></li>
<li><p><strong>Document Complex Queries</strong>: Add comments to explain complex query logic.</p></li>
<li><p><strong>Test with Sample Data</strong>: Test queries with representative sample data before production use.</p></li>
</ol>
</section>
<section id="example-integration">
<h2>Example Integration</h2>
<section id="python-integration">
<h3>Python Integration</h3>
<p><a href="#id160"><span class="problematic" id="id161">``</span></a><a href="#id162"><span class="problematic" id="id163">`</span></a>python
import requests
import json</p>
<dl>
<dt>class ProvChainSPARQL:</dt><dd><dl>
<dt>def __init__(self, base_url, api_key):</dt><dd><p>self.base_url = base_url
self.headers = {</p>
<blockquote>
<div><p>‘Authorization’: f’Bearer {api_key}’,
‘Content-Type’: ‘application/sparql-query’</p>
</div></blockquote>
<p>}</p>
</dd>
<dt>def execute_query(self, sparql_query, format=’json’):</dt><dd><p>“””Execute a SPARQL query and return results.”””
params = {‘format’: format} if format else {}
response = requests.post(</p>
<blockquote>
<div><p>f’{self.base_url}/sparql’,
headers=self.headers,
data=sparql_query,
params=params</p>
</div></blockquote>
<p>)
response.raise_for_status()
return response.json()</p>
</dd>
<dt>def track_batch(self, batch_id):</dt><dd><p>“””Track a batch through the supply chain.”””
query = f”””
PREFIX trace: &lt;<a class="reference external" href="http://provchain.org">http://provchain.org</a>/trace#&gt;
PREFIX prov: &lt;<a class="reference external" href="http://www.w3.org/ns">http://www.w3.org/ns</a>/prov#&gt;</p>
<dl>
<dt>SELECT ?activity ?agent ?timestamp ?location WHERE {{</dt><dd><dl class="simple">
<dt>?batch a trace:ProductBatch ;</dt><dd><p>trace:hasBatchID “{batch_id}” .</p>
</dd>
<dt>?activity prov:used ?batch ;</dt><dd><p>prov:wasAssociatedWith ?agent ;
trace:recordedAt ?timestamp .</p>
</dd>
<dt>OPTIONAL {{</dt><dd><p>?activity :atLocation ?location .</p>
</dd>
</dl>
<p>}}</p>
</dd>
</dl>
<p>}}
ORDER BY ?timestamp
“””
return self.execute_query(query)</p>
</dd>
<dt>def get_environmental_conditions(self, batch_id, temp_threshold=5.0):</dt><dd><p>“””Get environmental conditions for a batch.”””
query = f”””
PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?temperature ?humidity ?location ?timestamp WHERE {{</dt><dd><p>:{batch_id} :transportedThrough ?transport .
?transport :environmentalCondition ?condition .
?condition :temperature ?temperature ;</p>
<blockquote>
<div><p>:humidity ?humidity ;
:location ?location ;
:recordedAt ?timestamp .</p>
</div></blockquote>
<p>FILTER(?temperature &gt; {temp_threshold})</p>
</dd>
</dl>
<p>}}
ORDER BY ?timestamp DESC
“””
return self.execute_query(query)</p>
</dd>
</dl>
</dd>
</dl>
<p># Usage
sparql_api = ProvChainSPARQL(’<a class="reference external" href="http://localhost:8080">http://localhost:8080</a>’, ‘YOUR_API_KEY’)</p>
<p># Track a batch
trace = sparql_api.track_batch(‘BATCH-001’)
print(f”Batch trace: {len(trace[‘results’][‘bindings’])} events”)</p>
<p># Check environmental conditions
conditions = sparql_api.get_environmental_conditions(‘BATCH-001’)
print(f”High temperature events: {len(conditions[‘results’][‘bindings’])}”)
<a href="#id164"><span class="problematic" id="id165">``</span></a><a href="#id166"><span class="problematic" id="id167">`</span></a></p>
</section>
<section id="javascript-integration">
<h3>JavaScript Integration</h3>
<p><a href="#id168"><span class="problematic" id="id169">``</span></a><a href="#id170"><span class="problematic" id="id171">`</span></a>javascript
class ProvChainSPARQL {</p>
<blockquote>
<div><dl>
<dt>constructor(baseUrl, apiKey) {</dt><dd><p>this.baseUrl = baseUrl;
this.headers = {</p>
<blockquote>
<div><p>‘Authorization’: <cite>Bearer ${apiKey}</cite>,
‘Content-Type’: ‘application/sparql-query’</p>
</div></blockquote>
<p>};</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>async executeQuery(sparqlQuery, format = ‘json’) {</dt><dd><p>const params = format ? { format } : {};</p>
<dl class="simple">
<dt>const response = await fetch(<cite>${this.baseUrl}/sparql</cite>, {</dt><dd><p>method: ‘POST’,
headers: this.headers,
body: sparqlQuery,
params</p>
</dd>
</dl>
<p>});</p>
<dl class="simple">
<dt>if (!response.ok) {</dt><dd><p>throw new Error(<cite>Query failed: ${response.statusText}</cite>);</p>
</dd>
</dl>
<p>}</p>
<p>return await response.json();</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>async getBatchStatus(batchId) {</dt><dd><dl>
<dt>const query = `</dt><dd><p>PREFIX trace: &lt;<a class="reference external" href="http://provchain.org">http://provchain.org</a>/trace#&gt;</p>
<dl class="simple">
<dt>SELECT ?status ?timestamp WHERE {</dt><dd><dl class="simple">
<dt>:${batchId} a trace:ProductBatch ;</dt><dd><p>trace:hasStatus ?status ;
trace:statusTimestamp ?timestamp .</p>
</dd>
</dl>
</dd>
</dl>
<p>}
ORDER BY DESC(?timestamp)
LIMIT 1</p>
</dd>
</dl>
<p><a href="#id172"><span class="problematic" id="id173">`</span></a>;</p>
<p>return await this.executeQuery(query);</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>async findBatchesByFarm(farmName) {</dt><dd><dl>
<dt>const query = `</dt><dd><p>PREFIX : &lt;<a class="reference external" href="http://example.org/supply">http://example.org/supply</a>-chain#&gt;</p>
<dl>
<dt>SELECT ?batch ?product ?harvestDate WHERE {</dt><dd><dl class="simple">
<dt>?batch a :ProductBatch ;</dt><dd><p>:originFarm ?farm ;
:product ?product ;
:harvestDate ?harvestDate .</p>
</dd>
</dl>
<p>?farm :name “${farmName}” .</p>
</dd>
</dl>
<p>}
ORDER BY ?harvestDate DESC</p>
</dd>
</dl>
<p><a href="#id174"><span class="problematic" id="id175">`</span></a>;</p>
<p>return await this.executeQuery(query);</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>// Usage
const sparqlApi = new ProvChainSPARQL(’<a class="reference external" href="http://localhost:8080">http://localhost:8080</a>’, ‘YOUR_API_KEY’);</p>
<p>// Get batch status
sparqlApi.getBatchStatus(‘BATCH-001’).then(status =&gt; {</p>
<blockquote>
<div><p>console.log(‘Current status:’, status.results.bindings[0]);</p>
</div></blockquote>
<p>});</p>
<p>// Find batches from specific farm
sparqlApi.findBatchesByFarm(‘Green Valley Farm’).then(batches =&gt; {</p>
<blockquote>
<div><p>console.log(<cite>Found ${batches.results.bindings.length} batches</cite>);</p>
</div></blockquote>
<section id="id176">
<h4>});</h4>
</section>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting</h2>
<section id="common-issues">
<h3>Common Issues</h3>
<dl class="simple">
<dt><strong>Query Timeout</strong></dt><dd><ul class="simple">
<li><p>Reduce result set size with LIMIT</p></li>
<li><p>Optimize FILTER conditions</p></li>
<li><p>Break complex queries into simpler parts</p></li>
</ul>
</dd>
<dt><strong>Memory Issues</strong></dt><dd><ul class="simple">
<li><p>Use streaming results for large datasets</p></li>
<li><p>Implement pagination with OFFSET/LIMIT</p></li>
<li><p>Consider using CONSTRUCT instead of SELECT</p></li>
</ul>
</dd>
<dt><strong>Permission Denied</strong></dt><dd><ul class="simple">
<li><p>Verify API key validity</p></li>
<li><p>Check user permissions for update operations</p></li>
<li><p>Ensure authentication headers are correct</p></li>
</ul>
</dd>
<dt><strong>No Results</strong></dt><dd><ul class="simple">
<li><p>Verify URIs and prefixes are correct</p></li>
<li><p>Check data exists in expected graphs</p></li>
<li><p>Test with simpler patterns first</p></li>
</ul>
</dd>
<dt><strong>Performance Issues</strong></dt><dd><ul class="simple">
<li><p>Add appropriate indexes</p></li>
<li><p>Use specific property paths</p></li>
<li><p>Filter early in the query</p></li>
</ul>
</dd>
</dl>
</section>
<section id="getting-help">
<h3>Getting Help</h3>
<ul class="simple">
<li><p><strong>SPARQL Specification</strong>: Refer to W3C SPARQL 1.1 specifications</p></li>
<li><p><strong>Query Examples</strong>: Browse the examples section for common patterns</p></li>
<li><p><strong>Performance Tuning</strong>: Consult optimization best practices</p></li>
<li><p><strong>Community Support</strong>: Join discussions for help with complex queries</p></li>
<li><p><strong>Enterprise Support</strong>: Contact support for production issues</p></li>
</ul>
</section>
</section>
<section id="related-resources">
<h2>Related Resources</h2>
<ul class="simple">
<li><p><strong>SPARQL 1.1 Query Language</strong>: W3C Recommendation</p></li>
<li><p><strong>SPARQL 1.1 Update Language</strong>: W3C Recommendation</p></li>
<li><p><strong>RDF 1.1 Concepts</strong>: W3C Recommendation</p></li>
<li><p><strong>ProvChainOntology</strong>: Traceability ontology documentation</p></li>
<li><p><strong>Best Practices Guide</strong>: Query optimization and performance</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>