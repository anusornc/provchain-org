@prefix : <http://provchain.org/advanced-owl2-reasoning#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:  <http://www.w3.org/2002/07/owl#> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix core: <http://provchain.org/core#> .

#################################################################
# Advanced OWL2 Features Ontology
# Purpose: Demonstrate owl:hasKey, property chains, and qualified cardinality
#################################################################

# Import the generic core ontology
owl:imports <http://provchain.org/core> .

:TestEntity a owl:Class ;
  rdfs:label "TestEntity" ;
  rdfs:subClassOf core:TraceableEntity ;
  rdfs:comment "Test entity for OWL2 feature validation" .

# Define owl:hasKey constraint with single property
:Batch a owl:Class ;
  rdfs:label "Batch" ;
  rdfs:subClassOf core:Batch ;
  owl:hasKey ( :batchId ) ;
  rdfs:comment "A batch with a unique batch ID" .

# Define owl:hasKey constraint with multiple properties
:ProductBatch a owl:Class ;
  rdfs:label "ProductBatch" ;
  rdfs:subClassOf core:Batch ;
  owl:hasKey ( :productId :batchNumber ) ;
  rdfs:comment "A product batch with a composite key" .

# Define property chains
:suppliedTo a owl:ObjectProperty ;
  rdfs:label "suppliedTo" ;
  rdfs:domain core:TraceableEntity ;
  rdfs:range core:TraceableEntity ;
  rdfs:comment "Direct supply relationship" .

:transitivelySuppliedTo a owl:ObjectProperty ;
  rdfs:label "transitivelySuppliedTo" ;
  rdfs:domain core:TraceableEntity ;
  rdfs:range core:TraceableEntity ;
  rdfs:comment "Transitive supply relationship" ;
  owl:propertyChainAxiom ( :suppliedTo :suppliedTo ) .

# Define qualified cardinality restrictions
:ManufacturingProcess a owl:Class ;
  rdfs:label "ManufacturingProcess" ;
  rdfs:subClassOf core:ManufacturingProcess ;
  rdfs:comment "A manufacturing process with required inputs" ;
  rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty core:derivedFrom ;
    owl:qualifiedCardinality "2"^^xsd:nonNegativeInteger ;
    owl:onClass core:RawMaterial
  ] ;
  rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty core:hasCertificate ;
    owl:minQualifiedCardinality "1"^^xsd:nonNegativeInteger ;
    owl:onClass core:Certificate
  ] .

# Define data properties
:batchId a owl:DatatypeProperty ;
  rdfs:label "batchId" ;
  rdfs:domain :Batch ;
  rdfs:range xsd:string ;
  rdfs:comment "Unique identifier for the batch" ;
  rdfs:subPropertyOf core:hasIdentifier .

:productId a owl:DatatypeProperty ;
  rdfs:label "productId" ;
  rdfs:domain :ProductBatch ;
  rdfs:range xsd:string ;
  rdfs:comment "Product identifier" ;
  rdfs:subPropertyOf core:hasIdentifier .

:batchNumber a owl:DatatypeProperty ;
  rdfs:label "batchNumber" ;
  rdfs:domain :ProductBatch ;
  rdfs:range xsd:string ;
  rdfs:comment "Batch number" .

:requiresIngredient a owl:ObjectProperty ;
  rdfs:label "requiresIngredient" ;
  rdfs:domain :ManufacturingProcess ;
  rdfs:range core:TraceableEntity ;
  rdfs:comment "Required ingredient for manufacturing" .

:requiresCertificate a owl:ObjectProperty ;
  rdfs:label "requiresCertificate" ;
  rdfs:domain :ManufacturingProcess ;
  rdfs:range core:TraceableEntity ;
  rdfs:comment "Required certificate for manufacturing" .

:MilkIngredient a owl:Class ;
  rdfs:label "MilkIngredient" ;
  rdfs:subClassOf core:RawMaterial ;
  rdfs:comment "Milk ingredient for manufacturing" .

:SafetyCertificate a owl:Class ;
  rdfs:label "SafetyCertificate" ;
  rdfs:subClassOf core:Certificate ;
  rdfs:comment "Safety certificate for manufacturing" .